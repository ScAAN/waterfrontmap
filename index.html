<html>
  <meta charset="UTF-8">
  <head>
    <script src='https://api.mapbox.com/mapbox-gl-js/v0.43.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v0.43.0/mapbox-gl.css' rel='stylesheet' />
    <link href='stuff.css' rel='stylesheet' />
  </head>
  <body>
    <style>
      
      .legend {
      background-color: #fff;
      border-radius: 3px;
      bottom: 20px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.10);
	  border: 1px solid rgba(0,0,0,0.4);
      font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
      padding: 10px;
      position: absolute;
      right: 10px;
      z-index: 1;
	  width:140px; 
	  height:270px;
      }
      
      .legend h4 {
	  margin: 0 0 10px;
      }
      
      .legend div span {
	  border-radius: 50%;
	  display: inline-block;
	  height: 10px;
	  margin-right: 5px;
	  width: 10px;
      }
      
      #menu {
	  background: #fff;
	  position: absolute;
	  z-index: 5;
	  top: 10px;
	  right: 10px;
	  border-radius: 3px;
	  width: 160px;
	  border: 1px solid rgba(0,0,0,0.4);
	  font-family: 'Open Sans', sans-serif;
      }
      
      #menu a {
	  font-size: 13px;
	  color: #404040;
	  display: block;
	  margin: 0;
	  padding: 0;
	  padding: 10px;
	  text-decoration: none;
	  border-bottom: 1px solid rgba(0,0,0,0.25);
	  text-align: center;
      }
      
      #menu a:last-child {
	  border: none;
      }
      
      #menu a:hover {
	  background-color: #f8f8f8;
	  color: #404040;
      }
      
      #menu a.active {
	  background-color: #3887be;
	  color: #ffffff;
      }
      
      #menu a.active:hover {
	  background: #3074a4;
      }
      
      .map-overlay-info {
		  z-index: 1;
      	  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
      	  background-color: #fff;
      	  box-shadow: 0 1px 2px rgba(0,0,0,0.10);
      	  border-radius: 3px;
      	  position: absolute;
      	  width: 270px;
      	  bottom: 20px;
      	  left: 10px;
      	  padding: 10px;
      	  display: none;
      }
      
      .text-info-box {
		  position: absolute;
      	  font: 16px 'Helvetica Neue', Helvetica, sans-serif;
      	  background-color: #fff;
      	  position: absolute;
      	  width: 22em;
      	  top: 10px;
      	  left: 10px;
      	  display: block;
          border-radius: 3px;
          box-shadow: 0 1px 2px rgba(0,0,0,0.10);
          padding: 10px;
      }

      @media screen and (max-height: 200px) {
          #pd {
              display: none;
          }
      }

    </style>    
    <nav id="menu"></nav>
    <title>Waterfront Justice Project</title>
    <div id='map'></div>
    <div id='map-overlay-info' class='map-overlay-info'></div>
    <div id='zoning-legend' class='legend' style='display: none;'>
      <div style="text-align:right">
		<div style="display:inline-block;line-height:100%">Significant Maritime<br/>and Industrial Areas</div>
		<span style='vertical-align:middle;outline-color: #000000;outline-style: solid;margin-bottom:12px;margin-left:10px;'></span>
	  </div>
	  <div style="text-align:right"><span style='background-color: #ffffff'></span></div>
	  <h4 style="text-align:right;line-height:100%">Land Use <br/> (from NYC zoning)</h4>
      <div style="text-align:right">Residential <span style='background-color: #80b1d3;margin-left:10px;'></span></div>
      <div style="text-align:right">NYC Parks <span style='background-color: #b3de69;margin-left:10px;'></span></div>
      <div style="text-align:right">Manufacturing <span style='background-color: #fb8072;margin-left:10px;'></span></div>
      <div style="text-align:right">Commercial <span style='background-color: #fdb462;margin-left:10px;'></span></div>
      <div style="text-align:right">
		<div style="display:inline-block;line-height:100%">Mixed manufacturing<br/>and residential</div>
		<span style='vertical-align:middle;background-color: #bebada;margin-left:10px;margin-bottom:10px;'></span>
	  </div>
      <div style="text-align:right;">Battery Park City <span style='background-color: #ffffb3;margin-left:10px;'></span></div>
    </div>
    <div id='race-legend' class='legend' style='display: block;'>
      <div style="text-align:right">
		<div style="display:inline-block;line-height:100%">Significant Maritime<br/>and Industrial Areas</div>
		<span style='vertical-align:middle;outline-color: #000000;outline-style: solid;margin-bottom:12px;margin-left:10px;'></span>
	  </div>
	  <div style="text-align:right"><span style='background-color: #ffffff'></span></div>
	  <h4 style="text-align:right">Percent People of Color</h4>
      <div style="text-align:right">0% &#8211 10%<span style='background-color: #e7f0fa;margin-left:10px;'></span></div>
      <div style="text-align:right">11% &#8211 20%<span style='background-color: #d6e6f4;margin-left:10px;'></span></div>
      <div style="text-align:right">21% &#8211 30%<span style='background-color: #c6dbef;margin-left:10px;'></span></div>
      <div style="text-align:right">31% &#8211 40%<span style='background-color: #abd0e6;margin-left:10px;'></span></div>
      <div style="text-align:right">41% &#8211 50%<span style='background-color: #8dc1dd;margin-left:10px;'></span></div>
      <div style="text-align:right">51% &#8211 60%<span style='background-color: #6aaed6;margin-left:10px;'></span></div>
      <div style="text-align:right">61% &#8211 70%<span style='background-color: #4f9bcb;margin-left:10px;'></span></div>
      <div style="text-align:right">71% &#8211 80%<span style='background-color: #3787c0;margin-left:10px;'></span></div>
      <div style="text-align:right">81% &#8211 90%<span style='background-color: #2070b4;margin-left:10px;'></span></div>
      <div style="text-align:right">91% &#8211 100%<span style='background-color: #105ba4;margin-left:10px;'></span></div>
    </div>
    <div id='poverty-legend' class='legend' style='display: none;'>
      <div style="text-align:right">
		<div style="display:inline-block;line-height:100%">Significant Maritime<br/>and Industrial Areas</div>
		<span style='vertical-align:middle;outline-color: #000000;outline-style: solid;margin-bottom:12px;margin-left:10px;'></span>
	  </div>
	  <div style="text-align:right"><span style='background-color: #ffffff'></span></div>
	  <h4 style="text-align:right;line-height:100%">Percent of Families<br/>Below Poverty Line</h4>
      <div style="text-align:right">0% &#8211 10%<span style='background-color: #fee7dc;margin-left:10px;'></span></div>
      <div style="text-align:right">11% &#8211 20%<span style='background-color: #fcbba1;margin-left:10px;'></span></div>
      <div style="text-align:right">21% &#8211 30%<span style='background-color: #fca082;margin-left:10px;'></span></div>
      <div style="text-align:right">31% &#8211 40%<span style='background-color: #fc8565;margin-left:10px;'></span></div>
      <div style="text-align:right">41% &#8211 50%<span style='background-color: #f34a36;margin-left:10px;'></span></div>
      <div style="text-align:right">51% &#8211 60%<span style='background-color: #ca181d;margin-left:10px;'></span></div>
      <div style="text-align:right">61% &#8211 70%<span style='background-color: #900a12;margin-left:10px;'></span></div>
      <div style="text-align:right">71% &#8211 80%<span style='background-color: #7d0913;margin-left:10px;'></span></div>
      <div style="text-align:right">81% &#8211 90%<span style='background-color: #6c0713;margin-left:10px;'></span></div>
      <div style="text-align:right">91% &#8211 100%<span style='background-color: #5c0613;margin-left:10px;'></span></div>
    </div>
    <div id='surge-legend' class='legend' style='display: none;'>
	  <div style="text-align:right">
		<div style="display:inline-block;line-height:100%">Significant Maritime<br/>and Industrial Areas</div>
		<span style='vertical-align:middle;outline-color: #000000;outline-style: solid;margin-bottom:12px;margin-left:10px;'></span>
	  </div>
	  <div style="text-align:right"><span style='background-color: #ffffff'></span></div>
	  <h4 style="text-align:right;line-height:100%">Hurricane Storm Surge Zones</h4>
      <div style="text-align:right">
		<div style="display:inline-block;line-height:100%">Category 1<br/>winds 74-95 mph</div>
		<span style='vertical-align:middle;background-color: #7a0177;margin-left:10px;margin-bottom:10px;'></span>
	  </div>
	  <div style="text-align:right">
		<div style="display:inline-block;line-height:100%">Category 2<br/>winds 96-110 mph</div>
		<span style='vertical-align:middle;background-color: #c51b8a;margin-left:10px;margin-bottom:10px;'></span>
	  </div>
	  <div style="text-align:right">
		<div style="display:inline-block;line-height:100%">Category 3<br/>winds 111-130 mph</div>
		<span style='vertical-align:middle;background-color: #f768a1;margin-left:10px;margin-bottom:10px;'></span>
	  </div>
	  <div style="text-align:right">
		<div style="display:inline-block;line-height:100%">Category 4<br/>winds 131+ mph</div>
		<span style='vertical-align:middle;background-color: #fbb4b9;margin-left:10px;margin-bottom:10px;'></span>
	  </div>
    </div>
    <div id='neighborhood-legend' class='legend' style='display: none;'>
      <div style='float:right'>
		<div style="display:inline-block;line-height:100%">Significant Maritime<br/>and Industrial Areas</div>
		<span style='vertical-align:middle;outline-color: #000000;outline-style: solid;margin-bottom:12px;margin-left:10px;'></span>
	  </div>
	  <div style="text-align:right"><span style='background-color: #ffffff'></span></div>
	  <h4 style="text-align:right">Borough</h4>
      <div style="text-align:right">Brooklyn<span style='background-color: #aeffd1;margin-left:10px;'></span></div>
      <div style="text-align:right">Staten Island<span style='background-color: #233c95;margin-left:10px;'></span></div>
      <div style="text-align:right">Queens<span style='background-color: #a7d6eb;margin-left:10px;'></span></div>
      <div style="text-align:right">Manhattan<span style='background-color: #ffda8e;margin-left:10px;'></span></div>
      <div style="text-align:right">Bronx<span style='background-color: #f4af1f;margin-left:10px;'></span></div>
    </div>
	
	<div id='clickbox' class='text-info-box' style="cursor: pointer; z-index: 1;" onclick='showinfobox()'>
      <h2>NYC-EJA Waterfront Justice Project</h2>
	  <div id='pleaseclicktext'> <p>(click for more information!) </p> </div>
	</div>
	
    <div id='infobox' class='text-info-box' style='display: none; cursor: pointer; z-index: 10;' onclick='hideinfobox()'>
      <h2>NYC-EJA Waterfront Justice Project </h2>
      <div id='pd'>
        <p>Industrial and maritime development is encouraged by zoning regulations that have created Special Maritime and Industrial Areas (SMIAs) – areas with a less strict approval process than other waterfront applications. These designations were given in largely low-income communities of color without considering climate change impacts and vulnerable populations in these areas. The NYC-EJA advocates for regulations to protect those who live and work around the SMIAs by promoting the safe and responsible use of hazardous materials and toxic chemicals, as well as supporting climate change adaptation measures.</p>
      </div>
        <p style="font-size: 0.7em; color: #777777"><a href="http://www.nyc-eja.org/">NYC-EJA</a> and <a href="http://scaan.net">ScAAN</a>, 2018</p>
    </div>
	
    <script>
      mapboxgl.accessToken = 'pk.eyJ1IjoiYmlsbGJyb2QiLCJhIjoiY2o5N21wOWV5MDFlYjJ5bGd4aW9jZWwxNiJ9.LpT502DJ1ruuPRLp3AW_ow';
      var map = new mapboxgl.Map({
	  container: 'map',
	  style: 'mapbox://styles/mapbox/light-v9',
	  center: [-73.9978, 40.7209],
	  zoom: 10,
	  legendControl: {
	      position: 'bottomright'
	  }
      });
      
      var overlay = document.getElementById('map-overlay-info');
      
      map.on('load', function () {

	  map.moveLayer("water", "road-trunk")
	  
	  map.addSource('census-tracts', {
	      type: 'geojson',
	      data: './Data/reduced_census.geojson'
	  })

	  
	  map.addLayer({
	      "id": "Zoning",
	      "type": "fill",
	      "source": {
	  	  type: 'geojson',
	  	  data: './Data/nyzd.geojson'
	      },
	      "paint": {
	  	  "fill-opacity": 0,
	  	  "fill-color": {
	  	      'property': 'human_readable_zone',
	  	      'type': 'categorical',
	  	      "stops": [
	  		  ['Residential', '#80b1d3'],
	  		  ['New York City Parks', '#b3de69'],
	  		  ['Manufacturing', '#fb8072'],
	  		  ['Commercial', '#fdb462'],
	  		  ['Mixed manufacturing and residential', '#bebada'],
	  		  ['Battery Park City', '#ffffb3']
	  	      ]
	  	  }
	      }
	  }, 'water');
	  map.addLayer({
	      "id": "Hurricane Storm Surge Zones",
	      "type": "fill",
	      "source": {
	  	  type: 'geojson',
	  	  data: './Data/storm_surge_min.json'
	      },
	      "paint": {
	  	  "fill-opacity": 0,
	  	  "fill-color": {
		      'property': 'CATEGORY',
	  	      'type': 'categorical',
	  	      "stops": [
	  		  [1, '#7a0177'],
			  [2, '#c51b8a'],
	  		  [3, '#f768a1'],
	  		  [4, '#fbb4b9']
	  	      ]
	  	  }
	      }
	  }, 'water');	  
	  map.addLayer({
	      "id": "Neighborhood",
	      "type": "fill",
	      "source": {
	  	  type: 'geojson',
	  	  data: './Data/Neighborhood_Map.geojson'
	      },
	      "paint": {
	  	  "fill-opacity": 0,
	  	  "fill-color": {
		      'property': 'borough',
	  	      'type': 'categorical',
	  	      "stops": [
	  		  ['Brooklyn', '#aeffd1'],
			  ['Staten Island', '#233c95'],
	  		  ['Queens', '#a7d6eb'],
	  		  ['Manhattan', '#ffda8e'],
			  ['Bronx', '#f4af1f']
	  	      ]
	  	  }
	      }
	  }, 'water');	  
	  map.addLayer({
	      "id": "Percent People of Color",
	      "type": "fill",
	      "source": 'census-tracts',
	      "paint": {
		  "fill-opacity": .75,
		  "fill-color": [
	  	      'interpolate',
	  	      ['linear'],
	  	      ['get', 'Perc_POC_P003009'],
		      -10, 'rgba(0, 0, 0, 0)',
	  	      0, '#e7f0fa',
	  	      11, '#d6e6f4',
	  	      21, '#c6dbef',
	  	      31, '#abd0e6',
	  	      41, '#8dc1dd',
	  	      51, '#6aaed6',
	  	      61, '#4f9bcb',
	  	      71, '#3787c0',
	  	      81, '#2070b4',
	  	      91, '#105ba4',
	  	      100, '#08468b'
		  ]
	      }
	  }, 'water');
	  
	  map.addLayer({
	      "id": "Percent of Families Below Poverty Line",
	      "type": "fill",
	      "source": 'census-tracts',
	      "paint": {
	  	  "fill-opacity": 0,
	  	  "fill-color": [
	  	      'interpolate',
	  	      ['linear'],
	  	      ['get', '% of Families Below Poverty Level'],
		      -10, 'rgba(0, 0, 0, 0)',
	  	      0, '#fee7dc',
	  	      10, '#fcbba1',
	  	      20, '#fca082',
	  	      30, '#fc8565',
	  	      40, '#f34a36',
	  	      50, '#ca181d',
	  	      60, '#900a12',
	  	      70, '#7d0913',
	  	      80, '#6c0713',
	  	      90, '#5c0613',
	  	      100, '#4c0513'
	  	  ]
	      }
	  }, 'water');

	  map.addLayer({
	      "id": "SMIA",
	      "type": "line",
	      "source": {
		  type: 'geojson',
		  data: './Data/smia.json'
	      },
	      "layout": {
		  "line-join": "round",
		  "line-cap": "round"
	      },
	      "paint": {
		  "line-color": "#000000",
		  "line-width": 3
	      }
	  });	  
	  
	  
	   map.addLayer({
	      "id": "SMIAfill",
	      "type": "fill",
	      "source": {
		  type: 'geojson',
		  data: './Data/smia.json'
	      },
	      "paint": {
		  "fill-color": "#000000",
		  "fill-opacity": 0
	      }
	  });	  
	  
	  map.addLayer({
	      "id": "SMIAhover",
	      "type": "fill",
	      "source": {
		  type: 'geojson',
		  data: './Data/smia.json'
	      },
	      "paint": {
		  "fill-color": "#000000",
		  "fill-opacity": .5
	      },
		  "filter": ["==", "OBJECTID", ""]
	  });	  
	  
	  
      });

      var toggleableLayerIds = ['Percent People of Color', 'Zoning', 'Percent of Families Below Poverty Line', 'Hurricane Storm Surge Zones'];
      var toggleableLegendIds = {'Percent People of Color': 'race-legend',
				 'Zoning': 'zoning-legend',
				 'Percent of Families Below Poverty Line': 'poverty-legend',
				 'Hurricane Storm Surge Zones': 'surge-legend'};
      var dataNames = {'human_readable_zone': 'Zone: ',
		       'Perc_POC_P003009': '% people of color: ',
		       '% of Families Below Poverty Level': '% families below poverty line: ',
		       'CATEGORY': 'Hurricane storm surge zone: '};
	  //       'borough':'NYC Borough: '};
      
      for (var i = 0; i < toggleableLayerIds.length; i++) {
      	  var id = toggleableLayerIds[i];
	  
      	  var link = document.createElement('a');
      	  link.href = '#';
      	  link.textContent = id;
	  if (id === 'Percent People of Color') {
	      link.className = 'active';
	  } else {
	      link.className = '';
	  }
	  link.id = 'toggler-' + id
	  
      	  link.onclick = function(e) {
      	      var clickedLayer = this.textContent;
      	      e.preventDefault();
	      e.stopPropagation();
	      for (var j = 0; j < toggleableLayerIds.length; j++) {
		  var otherLayerName = toggleableLayerIds[j]
		  if (otherLayerName != clickedLayer) {
		      document.getElementById('toggler-' + otherLayerName).className = '';
		      map.setPaintProperty(otherLayerName, 'fill-opacity', 0);
		      document.getElementById(toggleableLegendIds[otherLayerName]).style.display = 'none';
		  }
	      }
      	      this.className = 'active';
	      map.setPaintProperty(clickedLayer, 'fill-opacity', .75);
	      document.getElementById(toggleableLegendIds[clickedLayer]).style.display = 'block';	      
      	  };

      	  var layers = document.getElementById('menu');
      	  layers.appendChild(link);

      };
      
      map.on('click', function(e) {
	  // Change the cursor style as a UI indicator.
	  map.getCanvas().style.cursor = 'pointer';
	  
	  var queried = map.queryRenderedFeatures(e.point)
	  overlay.innerHTML = '';
	  var shownData = [];
	  
	  for (var j = 0; j < queried.length; j++){
	      var data = queried[j].properties
	      debugger;
	      
	      for (var i = 0; i < Object.keys(dataNames).length; i++) {
		  
		  var dataKey = Object.keys(dataNames)[i];
		  // if we haven't already found this data
		  if (shownData.indexOf(dataKey) == -1) {
		      var dataDisplay = document.createElement('div');
		      if (dataNames[dataKey].includes('%')){
			  if (data[dataKey] > 0) {
			      dataDisplay.innerHTML = '<b>' + dataNames[dataKey] + '</b>' + Math.round(data[dataKey]);
			  } else {
			      dataDisplay.innerHTML = '<b>' + dataNames[dataKey] + '</b>'  + 'not enough data';
			  }
			  shownData.push(dataKey)
		      } else if (typeof(data[dataKey]) != 'undefined') {
				dataDisplay.innerHTML = '<b>' + dataNames[dataKey] + '</b>' + data[dataKey];
				shownData.push(dataKey)
		      }
		      
		      overlay.appendChild(dataDisplay);
		  }
	      }}
	  overlay.style.display = 'block';

      });
      
      map.on('mouseenter', 'Percent People of Color', function (e) {
	  map.getCanvas().style.cursor = 'pointer';
      });
      
      map.on('mouseleave', 'Percent People of Color', function (e) {
	  map.getCanvas().style.cursor = '';
      });
	  
	  
	  map.on('mousemove', function(e) {
		var whichsmia = map.queryRenderedFeatures(e.point, {
		layers: ['SMIAfill']
		});

		if (whichsmia.length > 0) {
		document.getElementById('pleaseclicktext').innerHTML = '<h3>SMIA # ' + whichsmia[0].properties.OBJECTID + ' : ' + whichsmia[0].properties.SMIA_Name + '</strong></h3>';
		} else {
		document.getElementById('pleaseclicktext').innerHTML = '<p> Click here for more information or hover over a SMIA!</p>';
		}
	  });

		  // MH SMIA FILL CODE
	  // When the user moves their mouse over the states-fill layer, we'll update the filter in
    // the state-fills-hover layer to only show the matching state, thus making a hover effect.
      map.on("mousemove", "SMIAfill", function(e) {
        map.setFilter("SMIAhover", ["==", "OBJECTID", e.features[0].properties.OBJECTID]);
      });

    // Reset the state-fills-hover layer's filter when the mouse leaves the layer.
      map.on("mouseleave", "SMIAfill", function() {
        map.setFilter("SMIAhover", ["==", "OBJECTID", ""]);
      });
	  
	  
	  // MH: sloppy way of showing and hiding infobox 
	  function showinfobox(){
		document.getElementById('infobox').style.display = 'block';
		document.getElementById('clickbox').style.display = 'none';
	  }
	  function hideinfobox(){
		document.getElementById('infobox').style.display = 'none';
		document.getElementById('clickbox').style.display = 'block';
	  }
	  
    </script>
  </body>
</html>



