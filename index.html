<html>
<meta charset="UTF-8">
<head>
  <script src='https://api.mapbox.com/mapbox-gl-js/v0.43.0/mapbox-gl.js'></script>
  <link href='https://api.mapbox.com/mapbox-gl-js/v0.43.0/mapbox-gl.css' rel='stylesheet' />
  <link href='stuff.css' rel='stylesheet' />
  <script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v2.2.0/mapbox-gl-geocoder.min.js'></script>
  <link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v2.2.0/mapbox-gl-geocoder.css' type='text/css' />
</head>
<body>
  <style>

  .marker{
    border-radius: 50%;
    display: inline-block;
    height: 30px;
    width: 30px;
    position: absolute;
    right: 4px;
  }

  .legend {
    background-color: #fff;
    border-radius: 3px;
    bottom: 20px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.10);
    border: 1px solid rgba(0,0,0,0.4);
    font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
    padding: 10px;
    position: absolute;
    right: 10px;
    z-index: 1;
    width:140px;
    height:275px;
  }

  .legend h4 {
    font: 16px 'Helvetica Neue', sans-serif;
    margin: 0 0 10px;

  }

  .legend div span {
    border-radius: 50%;
    display: inline-block;
    height: 10px;
    margin-right: 5px;
    width: 10px;
  }

  .legend-info h4 {
    font: 16px 'Helvetica Neue', sans-serif;
    margin: 0 0 10px;
  }

  .legend-info {
    background-color: #fff;
    border-radius: 3px;
    bottom: 20px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.10);
    border: 1px solid rgba(0,0,0,0.4);
    font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
    padding: 10px;
    position: absolute;
    right: 170px;
    z-index: 1;
    width:140px;
    height:200px;
    display:none;
    line-height: normal;
  }

  .legend-seam {
    background-color: #fff;
    bottom: 21px;
    font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
    padding: 10px;
    position: absolute;
    right: 162px;
    z-index: 20;
    width:.2px;
    height:199.5px;
    display:none;
    border-right-style: none;
    margin-top:-50px;
  }

  #menu {
    background: #fff;
    position: absolute;
    z-index: 1;
    top: 10px;
    right: 10px;
    border-radius: 3px;
    width: 160px;
    border: 1px solid rgba(0,0,0,0.4);
    font-family: 'Open Sans', sans-serif;
  }

  #menu a {
    font-size: 13px;
    color: #404040;
    display: block;
    margin: 0;
    padding: 0;
    padding: 10px;
    text-decoration: none;
    border-bottom: 1px solid rgba(0,0,0,0.25);
    text-align: center;
  }

  #menu a:last-child {
    border: none;
  }

  #menu a:hover {
    background-color:   #f2f3f4;
    color: #404040;
  }

  #menu a.active {
    background-color:  #34495e;
    color: #ffffff;
  }

  #menu a.active:hover {
    background:   #283747;
  }

  .map-overlay-info {
    z-index: 1;
    font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
    padding: 10px;
    display: none;
  }

  .text-info-box {
    position: absolute;
    font: 16px 'Helvetica Neue', Helvetica, sans-serif;
    background-color: #fff;
    position: absolute;
    width: 22em;
    top: 10px;
    left: 10px;
    display: block;
    border-radius: 3px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.10);
    padding: 10px;
  }

  .zoom-button {
    position: absolute;
    z-index: 1;
    font: 16px 'Helvetica Neue', Helvetica, sans-serif;
    background-color: #fff;
    box-shadow: 0 1px 2px rgba(0,0,0,0.10);
    border-radius: 3px;
    position: absolute;
    width: 30px;
    height: 125px;
    top: 100px;
    left: 380px;
    padding: 5px;
    display: none;
  }

  .zoom-button:hover { background-color:    #f2f3f4 ; }
  .zoom-button:active {
    background-color:  #34495e;
    color: #ffffff;
    }

  .print-button {
    position: absolute;
    z-index: 1;
    font: 16px 'Helvetica Neue', Helvetica, sans-serif;
    background-color: #fff;
    box-shadow: 0 1px 2px rgba(0,0,0,0.10);
    border-radius: 3px;
    position: absolute;
    width: 30px;
    height: 30px;
    top: 10px;
    left: 390px;
    padding: 5px;
    display: block;
  }

  .print-button:hover { background-color:    #f2f3f4 ; }

  .print-button:active {
    background-color:  #34495e;
    color: #ffffff;
  }



  .full-button {
    position: absolute;
    z-index: 1;
    font: 16px 'Helvetica Neue', Helvetica, sans-serif;
    background-color: #fff;
    box-shadow: 0 1px 2px rgba(0,0,0,0.10);
    border-radius: 3px;
    position: absolute;
    width: 30px;
    height: 35px;
    padding: 5px;
    display: block;
  }

  .reset-button {
      top: 57px;
      left: 390px;
    }

  .legend-button {
    bottom:325px;
    right: 10px;
  }

  .full-button:hover { background-color:    #f2f3f4 ; }

  .full-button:active {
    background-color:  #34495e;
    color: #ffffff;
  }

  .button-box {
    width: 30%;
    display: inline-block;
  }

  .mode-button {
    z-index: 1;
    text-align: center;
    font: 16px 'Helvetica Neue', Helvetica, sans-serif;
    background-color: #fff;
    box-shadow: 0 1px 2px rgba(0,0,0,0.10);
    border-radius: 3px;
    margin: 2%;
    padding: 7px;
    cursor: pointer;
  }

  .box-content {
    display: none;
    cursor: pointer;
  }

  .mode-button.active {
    z-index: 1;
    text-align: center;
    font: 16px 'Helvetica Neue', Helvetica, sans-serif;
    background-color:  #34495e;
    box-shadow: 0 1px 2px rgba(0,0,0,0.10);
    border-radius: 3px;
    margin: 2%;
    padding: 7px;
    cursor: pointer;
    border: 1px solid rgba(0,0,0,0.4);
    color: #ffffff;
  }

  .mode-button.active:hover{background-color: #404040;}

  .mode-button:hover { background-color:    #f2f3f4 ; }

  .geocoder {
    position:absolute;
    z-index:1;
    width:90%;
    left:2.5%;
    top:20px;
    margin-top:30%;
    padding: 10px;
  }
  .mapboxgl-ctrl-geocoder { min-width:100%; }

  @media screen and (max-height: 200px) {
    #pd {
      display: none;
    }
  }

  </style>
  <nav id="menu"></nav>
  <title>Waterfront Justice Project</title>
  <div id='map'></div>
  <div id='zoning-legend' class='legend' style='display: none;'>
    <div style="text-align:right">
      <div style="display:inline-block;line-height:100%">Significant Maritime<br/>and Industrial Areas</div>
      <span style='vertical-align:middle;outline-color: #000000;outline-style: solid;margin-bottom:12px;margin-left:10px;'></span>
      <div style="display:inline-block;line-height:100%">Half-mile buffer<br/>to SMIAs</div>
      <span style='vertical-align:middle;outline-color: #000000;outline-style: dashed;margin-bottom:12px;margin-left:10px;'></span>
    </div>
    <div style="text-align:right"><span style='background-color: #ffffff'></span></div>
    <h4 style="text-align:right;line-height:100%">Land Use <br/> (from NYC zoning)</h4>
    <div style="text-align:right">Residential <span style='background-color: #80b1d3;margin-left:10px;'></span></div>
    <div style="text-align:right">NYC Parks <span style='background-color: #b3de69;margin-left:10px;'></span></div>
    <div style="text-align:right">Manufacturing <span style='background-color: #fb8072;margin-left:10px;'></span></div>
    <div style="text-align:right">Commercial <span style='background-color: #fdb462;margin-left:10px;'></span></div>
    <div style="text-align:right">
      <div style="display:inline-block;line-height:100%">Mixed manufacturing<br/>and residential</div>
      <span style='vertical-align:middle;background-color: #bebada;margin-left:10px;margin-bottom:10px;'></span>
    </div>
    <div style="text-align:right;">Battery Park City <span style='background-color: #ffffb3;margin-left:10px;'></span></div>
  </div>
  <div id='race-legend' class='legend' style='display: block;'>
    <div style="text-align:right">
      <div style="display:inline-block;line-height:100%">Significant Maritime<br/>and Industrial Areas</div>
      <span style='vertical-align:middle;outline-color: #000000;outline-style: solid;margin-bottom:12px;margin-left:10px;'></span>
      <div style="display:inline-block;line-height:100%">Half-mile buffer<br/>to SMIAs</div>
      <span style='vertical-align:middle;outline-color: #000000;outline-style: dashed;margin-bottom:12px;margin-left:10px;'></span>
    </div>
    <div style="text-align:right"><span style='background-color: #ffffff'></span></div>
    <h4 style="text-align:right">Percent People of Color</h4>
    <div style="text-align:right">0% &#8211 20%<span style='background-color: #feebe2;margin-left:10px;'></span></div>
    <div style="text-align:right">21% &#8211 40%<span style='background-color: #fbb4b9;margin-left:10px;'></span></div>
    <div style="text-align:right">41% &#8211 65%<span style='background-color: #f768a1;margin-left:10px;'></span></div>
    <div style="text-align:right">66% &#8211 90%<span style='background-color: #c51b8a;margin-left:10px;'></span></div>
    <div style="text-align:right">91% &#8211 100%<span style='background-color: #7a0177;margin-left:10px;'></span></div>
  </div>

  <div id='poverty-legend' class='legend' style='display: none;'>
    <div style="text-align:right">
      <div style="display:inline-block;line-height:100%">Significant Maritime<br/>and Industrial Areas</div>
      <span style='vertical-align:middle;outline-color: #000000;outline-style: solid;margin-bottom:12px;margin-left:10px;'></span>
      <div style="display:inline-block;line-height:100%">Half-mile buffer<br/>to SMIAs</div>
      <span style='vertical-align:middle;outline-color: #000000;outline-style: dashed;margin-bottom:12px;margin-left:10px;'></span>
    </div>
    <div style="text-align:right"><span style='background-color: #ffffff'></span></div>
    <h4 style="text-align:right;line-height:100%">Percent of Families<br/>Below Poverty Line</h4>
    <div style="text-align:right">0% &#8211 20%<span style='background-color: #fee5d9;margin-left:10px;'></span></div>
    <div style="text-align:right">21% &#8211 35%<span style='background-color: #fcae91;margin-left:10px;'></span></div>
    <div style="text-align:right">36% &#8211 50%<span style='background-color: #fb6a4a;margin-left:10px;'></span></div>
    <div style="text-align:right">51% &#8211 65%<span style='background-color: #de2d26;margin-left:10px;'></span></div>
    <div style="text-align:right">66% &#8211 100%<span style='background-color: #a50f15;margin-left:10px;'></span></div>
  </div>

  <div id='income-legend' class='legend' style='display: none;'>
    <div style="text-align:right">
      <div style="display:inline-block;line-height:100%">Significant Maritime<br/>and Industrial Areas</div>
      <span style='vertical-align:middle;outline-color: #000000;outline-style: solid;margin-bottom:12px;margin-left:10px;'></span>
      <div style="display:inline-block;line-height:100%">Half-mile buffer<br/>to SMIAs</div>
      <span style='vertical-align:middle;outline-color: #000000;outline-style: dashed;margin-bottom:12px;margin-left:10px;'></span>
    </div>

    <div style="text-align:right"><span style='background-color: #ffffff'></span></div>
    <h4 style="text-align:right;line-height:100%">Median Household Income</h4>
    <div style="text-align:right">
      <div style="display:inline-block;line-height:100%">$0 &#8211 $18000 <br/>(0 &#8211 20 percentile)</div>
      <span style='vertical-align:middle;background-color: #ffffcc;margin-left:10px;margin-bottom:10px;'></span>
    </div>
    <div style="text-align:right">
      <div style="display:inline-block;line-height:100%">$18001 &#8211 $39300 <br/>(20 &#8211 40 percentile)</div>
      <span style='vertical-align:middle;background-color: #d9f0a3;margin-left:10px;margin-bottom:10px;'></span>
    </div>
    <div style="text-align:right">
      <div style="display:inline-block;line-height:100%">$39301 &#8211 $52300 <br/>(40 &#8211 50 percentile)</div>
      <span style='vertical-align:middle;background-color: #addd8e;margin-left:10px;margin-bottom:10px;'></span>
    </div>
    <div style="text-align:right">
      <div style="display:inline-block;line-height:100%">$52301 &#8211 $67600 <br/>(50 &#8211 60 percentile)</div>
      <span style='vertical-align:middle;background-color: #78c679;margin-left:10px;margin-bottom:10px;'></span>
    </div>
    <div style="text-align:right">
      <div style="display:inline-block;line-height:100%">$67601 &#8211 $115300 <br/>(60 &#8211 80 percentile)</div>
      <span style='vertical-align:middle;background-color: #31a354;margin-left:10px;margin-bottom:10px;'></span>
    </div>
    <div style="text-align:right">
      <div style="display:inline-block;line-height:100%">$115301 and up <br/>(80 &#8211 99 percentile)</div>
      <span style='vertical-align:middle;background-color: #006837;margin-left:10px;margin-bottom:10px;'></span>
    </div>
  </div>

  <div id='surge-legend' class='legend' style='display: none;'>
    <div style="text-align:right">
      <div style="display:inline-block;line-height:100%">Significant Maritime<br/>and Industrial Areas</div>
      <span style='vertical-align:middle;outline-color: #000000;outline-style: solid;margin-bottom:12px;margin-left:10px;'></span>
      <div style="display:inline-block;line-height:100%">Half-mile buffer<br/>to SMIAs</div>
      <span style='vertical-align:middle;outline-color: #000000;outline-style: dashed;margin-bottom:12px;margin-left:10px;'></span>
    </div>
    <div style="text-align:right"><span style='background-color: #ffffff'></span></div>
    <h4 style="text-align:right;line-height:100%">Hurricane Storm Surge Zones</h4>
    <div style="text-align:right">
      <div style="display:inline-block;line-height:100%">Category 1<br/>winds 74-95 mph</div>
      <span style='vertical-align:middle;background-color: #d7301f;margin-left:10px;margin-bottom:10px;'></span>
    </div>
    <div style="text-align:right">
      <div style="display:inline-block;line-height:100%">Category 2<br/>winds 96-110 mph</div>
      <span style='vertical-align:middle;background-color: #fc8d59;margin-left:10px;margin-bottom:10px;'></span>
    </div>
    <div style="text-align:right">
      <div style="display:inline-block;line-height:100%">Category 3<br/>winds 111-130 mph</div>
      <span style='vertical-align:middle;background-color: #fdcc8a;margin-left:10px;margin-bottom:10px;'></span>
    </div>
    <div style="text-align:right">
      <div style="display:inline-block;line-height:100%">Category 4<br/>winds 131+ mph</div>
      <span style='vertical-align:middle;background-color: #fef0d9;margin-left:10px;margin-bottom:10px;'></span>
    </div>
  </div>

  <div id='neighborhood-legend' class='legend' style='display: none;'>
    <div style='float:right'>
      <div style="display:inline-block;line-height:100%">Significant Maritime<br/>and Industrial Areas</div>
      <span style='vertical-align:middle;outline-color: #000000;outline-style: solid;margin-bottom:12px;margin-left:10px;'></span>
      <div style="display:inline-block;line-height:100%">Half-mile buffer<br/>to SMIAs</div>
      <span style='vertical-align:middle;outline-color: #000000;outline-style: dashed;margin-bottom:12px;margin-left:10px;'></span>
    </div>
    <div style="text-align:right"><span style='background-color: #ffffff'></span></div>
    <h4 style="text-align:right">Borough</h4>
    <div style="text-align:right">Brooklyn<span style='background-color: #aeffd1;margin-left:10px;'></span></div>
    <div style="text-align:right">Staten Island<span style='background-color: #233c95;margin-left:10px;'></span></div>
    <div style="text-align:right">Queens<span style='background-color: #a7d6eb;margin-left:10px;'></span></div>
    <div style="text-align:right">Manhattan<span style='background-color: #ffda8e;margin-left:10px;'></span></div>
    <div style="text-align:right">Bronx<span style='background-color: #f4af1f;margin-left:10px;'></span></div>
  </div>

  <div id='bulk-legend' class='legend' style='display: none;'>
    <div style="text-align:right">
      <div style="display:inline-block;line-height:100%">Significant Maritime<br/>and Industrial Areas</div>
      <span style='vertical-align:middle;outline-color: #000000;outline-style: solid;margin-bottom:12px;margin-left:10px;'></span>
      <div style="display:inline-block;line-height:100%">Half-mile buffer<br/>to SMIAs</div>
      <span style='vertical-align:middle;outline-color: #000000;outline-style: dashed;margin-bottom:12px;margin-left:10px;'></span>
    </div>
    <div style="text-align:right"><span style='background-color: #ffffff'></span></div>
    <h4 style="text-align:right;line-height:100%">Bulk Storage Sites</h4>
    <div style='float:right'>
      <div style="display:inline-block;line-height:100%">Toxic Release<br/>Inventory Sites</div>
      <span style='vertical-align:middle;margin-bottom:30px;margin-left:10px;'><img class="marker" style="vertical-align:middle" src="Assets/fuel-11.svg"></img></span>
    </div>
    <div style='float:right'>
      <div style="display:inline-block;line-height:100%">Major Oil Storage<br/>Facilities</div>
      <span style='vertical-align:middle;margin-bottom:30px;margin-left:10px;'><img class="marker" src="Assets/rocket-11.svg"></img></span>
    </div>
    <div style='float:right'>
      <div style="display:inline-block;line-height:100%">Chemical Bulk<br/>Storage</div>
      <span style='vertical-align:middle;margin-bottom:30px;margin-left:10px;'><img class="marker" src="Assets/fire-station-11.svg"></img></span>
    </div>
    <div style='float:right'>
      <div style="display:inline-block;line-height:100%">Superfund<br/>Class 2 Sites</div>
      <span style='vertical-align:middle;margin-bottom:30px;margin-left:10px;'><img class="marker" src="Assets/volcano-11.svg"></img></span>
    </div>
    <div style="text-align:right"><span style='background-color: #ffffff'></span></div>
  </div>



  <div id='clickbox' class='text-info-box' style="cursor: pointer; z-index: 1;">
    <div style: style='margin:auto;text-align:center'>
      <h2>NYC-EJA Waterfront Justice Project</h2>
      <div class="button-box">
        <div id='storybutton' class='mode-button' onclick="showinfobox(event,'smiabox')"> <b>STORY</b> </div>
      </div>
      <div class="button-box">
        <div id='explorebutton' class='mode-button'   onclick="showinfobox(event,'explorebox')"> <b>EXPLORE</b> </div>
      </div>
      <div class="button-box">
        <div id='infobutton' class='mode-button'  onclick="showinfobox(event,'infotextbox')"> <b>INFO</b> </div>
      </div>
    </div>

    <div id='infotextbox' class='box-content'>
      <div id='pd'>
        <p>This map is a collaborative effort between NYC-EJA and ScAAN, furthering the work of NYC-EJA’s Waterfront Justice Project visualizing Special Maritime and Industrial Areas (SMIAs).
          <br/><br/>Industrial and maritime development is encouraged by zoning regulations that have created SMIAs – areas with a less strict approval process than other waterfront applications. These designations were given in largely low-income communities of color without considering climate change impacts and vulnerable populations in these areas. The NYC-EJA advocates for regulations to protect those who live and work around the SMIAs by promoting the safe and responsible use of hazardous materials and toxic chemicals, as well as supporting climate change adaptation measures.</p>
        </div>
        <div style="text-align:center;">
          <div style= 'display:inline-block;width:45%;margin:auto;text-align:center;'>
            <img src="Assets/nycejalliance.png" alt="ScAAN" style="height:60px;margin-left:auto;margin-right:auto;display:block;vertical-align:middle">
            <p style="font-size: 0.7em;"><a href="http://www.nyc-eja.org/">NYC-EJA</a> is a nonprofit citywide network founded in 1991, linking grassroots organizations from low-income communities of color in their struggle for environmental justice.</p>
          </div>
          <div style= 'display:inline-block;width:45%;margin:auto;text-align:center;'>
            <img src="Assets/scaan.png" alt="ScAAN" style="height:30px;margin-left:auto;margin-right:auto;display:block;vertical-align:middle">
            <p style="font-size: 0.7em;"><a href="http://scaan.net">ScAAN</a> is a New York-based group of scientists who use their expertise in partnership with organizations that are creating positive social change.
            </p>
          </div>
        </div>
        <p style="font-size: 0.7em; color: #777777;text-align:center;"><a href="http://www.nyc-eja.org/">NYC-EJA</a> and <a href="http://scaan.net">ScAAN</a>, 2018</p>
      </div>

      <div id='explorebox' class='box-content'>
        <div> <p>Click the map to explore a neighborhood, or search with the bar below. </p></div>
        <div style='margin-top:60px'></div>
        <div id='geocoder' class='geocoder'></div>
        <div id='map-overlay-info' class='map-overlay-info'></div>
      </div>

      <div id='smiabox' class='box-content'></div>

      <div id='zoombutton' class='zoom-button' onclick='fly_to_smia()'>
        <span style='top: 30%;left:15%;position:absolute'>
          <img class="marker" style="left:0%;transform:rotate(90deg);" src="Assets/triangle-15.svg"></img>
        </span>
        <span style='top: 50%;left:15%;position:absolute' ><p style="font-size: 0.7em;margin:0;text-align:center;">NEXT</p></span>
      </div>

    </div>

    <div id='fullbutton' class='full-button reset-button' style: style='display: block; cursor: pointer; z-index: 10;' onclick='reset_map_view()'>
      <span style='top: 5%;left:97%;position:absolute'><img class="marker" src="Assets/art-gallery-15.svg"></img></span>
      <span><p style="font-size: 0.7em;position:absolute;top:45%;margin-left: -4px;display:block">RESET</p></span>
    </div>

    <div id='legendbutton' class='full-button legend-button' style: style='display: block; cursor: pointer; z-index: 10;' onclick='show_legend_info()'>
      <span style='top: 5%;left:97%;position:absolute'><img class="marker" src="Assets/information-15.svg"></img></span>
      <span><p style="font-size: 0.7em;position:absolute;top:45%;margin-left: 2px;display:block">INFO</p></span>
    </div>

    <div id='printbutton' class='print-button' style: style='display: block; cursor: pointer; z-index: 10;' onclick='window.print()'>
      <span style='vertical-align:middle;'><img class="marker" src="Assets/attraction-15.svg"></img></span>
    </div>

    <div id='legendinfo' class='legend-info'></div>
    <div id='legendseam' class='legend-seam'></div>

    <script>
    mapboxgl.accessToken = 'pk.eyJ1IjoiYmlsbGJyb2QiLCJhIjoiY2o5N21wOWV5MDFlYjJ5bGd4aW9jZWwxNiJ9.LpT502DJ1ruuPRLp3AW_ow';
    var map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/light-v9?optimize=true',
      center: [-73.9978, 40.7209],
      zoom: 10,
      legendControl: {
        position: 'bottomright'
      },
      minZoom: 10,
      maxZoom: 13
    });

    var overlay = document.getElementById('map-overlay-info');

    var nav = new mapboxgl.NavigationControl();
    map.addControl(nav, 'bottom-left');
    map.on('load', function () {
      // add a source layer and default styling for a single point.
      map.addSource('single-point', {
        "type": "geojson",
        "data": {
          "type": "FeatureCollection",
          "features": []
        }
      });

      // display marker for geocoder, this is a symbol (marker-15)
      map.addLayer({
        "id": "point",
        "source": "single-point",
        "type": "symbol",
        "layout": {
          "icon-image": "marker-15",
          "icon-allow-overlap": true,
          "icon-size":1.5,
        }
      });


      map.moveLayer("water", "road-trunk")

      map.addSource('vector_data', {
        type: 'vector',
        url: 'mapbox://billbrod.7693fb16'
      })

      // from
      // https://github.com/mapbox/mapbox-gl-js/issues/5040#issuecomment-321688603;
      // apparently duplicating the source to have a separate
      // source for the hover effect improves performance. not
      // sure why that works, but whatever
      map.addSource('vector_data-hover', {
        type: 'vector',
        url: 'mapbox://billbrod.7693fb16'
      })

      // Code which adds a background pattern
      // - don't use this without a custom sprite sheet or it looks awkward
      // WIP- maija, need really tiny custom sprite (dashed lines - make with SVG!)
      // map.addLayer({
      //	"id": "BKG",
      //	"type": "background",
      //	"paint":{
      //	"background-pattern": "triangle-11"
      //	}
      //  },'water','Zoning')



      map.addLayer({
        "id": "Zoning",
        "type": "fill",
        "source": 'vector_data',
        "source-layer": 'nyzd',
        "layout": {"visibility":'visible'},
        "paint": {
          "fill-opacity": 0,
          "fill-color": {
            'property': 'human_readable_zone',
            'type': 'categorical',
            "stops": [
              ['Residential', '#80b1d3'],
              ['New York City Parks', '#b3de69'],
              ['Manufacturing', '#fb8072'],
              ['Commercial', '#fdb462'],
              ['Mixed manufacturing and residential', '#bebada'],
              ['Battery Park City', '#ffffb3']
            ]
          }
        }
      }, 'water');

      map.addLayer({
        "id": "Hurricane Storm Surge Zones",
        "type": "fill",
        "source": "vector_data",
        "source-layer": 'storm_surge_min',
        "layout": {"visibility":'visible'},
        "paint": {
          "fill-opacity": 0,
          "fill-color": {
            'property': 'CATEGORY',
            'type': 'categorical',
            "stops": [
              [1, '#d7301f'],
              [2, '#fc8d59'],
              [3, '#fdcc8a'],
              [4, '#fef0d9']
            ]
          }
        }
      }, 'water');

      // map.addLayer({
      //     "id": "Neighborhood",
      //     "type": "fill",
      //     "source": "vector_data",
      //     "source-layer": 'Neighborhood_Map',
      //     "layout": {"visibility":'none'},
      //     "paint": {
      // 	  "fill-opacity": 0,
      // 	  "fill-color": {
      // 	      'property': 'borough',
      // 	      'type': 'categorical',
      // 	      "stops": [
      // 		  ['Brooklyn', '#aeffd1'],
      // 		  ['Staten Island', '#233c95'],
      // 		  ['Queens', '#a7d6eb'],
      // 		  ['Manhattan', '#ffda8e'],
      // 		  ['Bronx', '#f4af1f']
      // 	      ]
      // 	  }
      //     }
      // }, 'water');

      map.addLayer({
        "id": "Percent People of Color",
        "type": "fill",
        "source": 'vector_data',
        "source-layer": "reduced_census",
        "layout": {"visibility":'visible'},
        "paint": {
          "fill-opacity": 1,
          "fill-color": {
            'property': 'Perc_POC_P003009',
            'type': 'interval',
            'stops': [
              [-10, 'rgba(0, 0, 0, 0)'],
              [0, '#feebe2'],
              [21, '#fbb4b9'],
              [41, '#f768a1'],
              [66, '#c51b8a'],
              [91, '#7a0177']
            ]
          }
        }
      }, 'water');

      map.addLayer({
        "id": "Median Household Income",
        "type": "fill",
        "source": 'vector_data',
        "source-layer": "reduced_census",
        "layout": {"visibility":'visible'},
        "paint": {
          "fill-opacity": 0,
          "fill-color": {
            'property': 'Median Household Income',
            'type': 'interval',
            'stops': [
              [-10, 'rgba(0, 0, 0, 0)'],
              [0, '#ffffcc'],
              [18001, '#d9f0a3'],
              [39301, '#addd8e'],
              [52301, '#78c679'],
              [67601, '#31a354'],
              [115301, '#006837']
            ]
          }
        }
      }, 'water');

      map.addLayer({
        "id": "Percent of Families Below Poverty Line",
        "type": "fill",
        "source": 'vector_data',
        "source-layer": "reduced_census",
        "layout": {"visibility":'visible'},
        "paint": {
          "fill-opacity": 0,
          "fill-color": {
            'property': '% of Families Below Poverty Level',
            'type': 'interval',
            'stops': [
              [-10, 'rgba(0, 0, 0, 0)'],
              [0, '#fee5d9'],
              [21, '#fcae91'],
              [36, '#fb6a4a'],
              [51, '#de2d26'],
              [66, '#a50f15']
            ]
          }
        }
      }, 'water');

      map.addLayer({
        "id": "Bulk Storage Sites",
        "type": "symbol",
        "source": "vector_data",
        "source-layer": 'TRI_converted',
        "layout": {
          "icon-image": "fuel-15",
          "icon-allow-overlap": true,
          "visibility": 'none',
          //"icon-size":10,
        }
      });

      map.addLayer({
        "id": "MOSF",
        "type": "symbol",
        "source": {
          type: 'geojson',
          data: './Data/MOSF_converted.json'
        },
        "layout": {
          "icon-image": "rocket-15",
          "icon-allow-overlap": true,
          "visibility": 'none',
          //"icon-size":10,
        }
      });

      map.addLayer({
        "id": "CBS",
        "type": "symbol",
        "source": {
          type: 'geojson',
          data: './Data/CBS_converted.json'
        },
        "layout": {
          "icon-image": "fire-station-15",
          "icon-allow-overlap": true,
          "visibility": 'none',
          //"icon-size":10,
        }
      });

      map.addLayer({
        "id": "SUPERFUND2",
        "type": "symbol",
        "source": {
          type: 'geojson',
          data: './Data/SUPERFUND2_converted.json'
        },
        "layout": {
          "icon-image": "volcano-15",
          "icon-allow-overlap": true,
          "visibility": 'none',
          //"icon-size":10,
        }
      });


      map.addLayer({
        "id": "SMIA",
        "type": "line",
        "source": "vector_data",
        "source-layer": 'smia',
        "layout": {
          "line-join": "round",
          "line-cap": "round"
        },
        "paint": {
          "line-color": "#000000",
          "line-width": 3
        }
      },'Bulk Storage Sites');

      map.addLayer({
        "id": "SMIA-buffer",
        "type": "line",
        "source": "vector_data",
        "source-layer": 'SMIA_halfmilebuffer_full',
        "layout": {
          "line-join": "round",
          "line-cap": "round"
        },
        "paint": {
          "line-color": "#000000",
          "line-width": 2,
          "line-dasharray": [1, 3]
        }
      },'Bulk Storage Sites');

      map.addLayer({
        "id": "SMIAfill",
        "type": "fill",
        "source": "vector_data",
        "source-layer": 'SMIA_halfmilebuffer_full',
        "paint": {
          "fill-color": "#000000",
          "fill-opacity": 0
        }
      },'Bulk Storage Sites');

      map.addLayer({
        "id": "SMIAhover",
        "type": "fill",
        "source": "vector_data-hover",
        "source-layer": 'SMIA_halfmilebuffer_full',
        "paint": {
          "fill-color": "#000000",
          "fill-opacity": .25,
        },
        "filter": ["==", "SMIA_Name", ""]
      },'Bulk Storage Sites');



    });

    // Layer names, numbers, and text
    var toggleableLayerIds = ['Percent People of Color', 'Zoning', 'Percent of Families Below Poverty Line', 'Hurricane Storm Surge Zones',
    'Median Household Income','Bulk Storage Sites'];
    var toggleableLegendIds = {'Percent People of Color': 'race-legend',
    'Zoning': 'zoning-legend',
    'Percent of Families Below Poverty Line': 'poverty-legend',
    'Hurricane Storm Surge Zones': 'surge-legend',
    'Median Household Income': 'income-legend',
    'Bulk Storage Sites': 'bulk-legend'};
    var dataNames = {'human_readable_zone': 'Land use: ',
    'Perc_POC_P003009': 'Percent people of color: ',
    '% of Families Below Poverty Level': 'Percent below poverty level: ',
    'CATEGORY': 'Hurricane zone: ',
    'Median Household Income': 'Median household income: '};
    // 'neighborhood':'NYC Neighborhood: '};
    var smiaNumbers = {'Brooklyn Navy Yard':'1',
    'Newtown Creek':'2',
    'Staten Island West Shore':'3',
    'Red Hook':'4',
    'South Bronx':'5',
    'Sunset Park':'6',
    'Kill Van Kull':'7'};
    var smiaTitle = ['SMIA # 1 : Brooklyn Navy Yard',
    'SMIA # 2 : Newtown Creek',
    'SMIA # 3 : Staten Island West Shore',
    'SMIA # 4 : Red Hook',
    'SMIA # 5 : South Bronx',
    'SMIA # 6 : Sunset Park',
    'SMIA # 7 : Kill Van Kull'];
    var smiaText = {'Brooklyn Navy Yard':'The Brooklyn Navy Yard is a 227-acre publicly owned industrial park characterized by a diversity of small buisnesses. The Navy Yard has more than 2,000 permanent jobs on site, and provides an estimated 3,000 temporary jobs to crews of film and telivision shoots at Steiner Studios. The robust increase in buisness activity between 200 and 2008 is attributed to a dramatic redevlopment effort, harnessing more than $500 million in public and private investment.',
    'Newtown Creek':'Newtown Creek, at over 780 acres the city’s largest SMIA, abuts portions of the Greenpoint, Williamsburg, Long Island City, and Maspeth industrial areas. The waterfront area is characterized by heavy industry and municipal facilities, many of which are water-dependent.',
    'Staten Island West Shore':'No information about this SMIA yet.',
    'Red Hook':'The Red Hook SMIA is approximately 120 acres and is more than 90 percent publicly owned. The SMIA is home to the Red Hook Container Terminal and Brooklyn Piers Port Authority Marine Terminal.',
    'South Bronx':'The South Bronx SMIA is more than 850 acres in size, stretching from Port Morris on the Harlem River to Hunts Point on the East river. Wholesale trade is the dominant industry. The SMIA is home to the citys produce distribution center at Hunts Point, the Fulton Fish market, and other food distributors.',
    'Sunset Park':'Nearly 600 acres, the Sunset Park SMIA extends from Erie Basin to Owls Head, an area characterized by water-dependent facilities, concentrations  of  industrial  activity,  well-buffered  manufacturing  districts,  and  vacant  sites  and  brownfields  of  significant  size.  A  small portion of the SMIA abuts the Gowanus Canal, a waterway that was designated a Superfund Site in 2010.',
    'Kill Van Kull':'The Kill Van Kull SMIA stretches from Howland Hook to Snug harbor. It contains a concentration of maritime uses including a marine terminal and dry docks for ship repair. The SMIA is approximately 665 acres and zoned to permit a broad range of commercial and industrial uses. In 2008, there were more than 70 firms emplying more than 3,300 people in the SMIA. The overwhelming number of jobs - more than 70 percent - were in transportation and warehousing.'};

    var smiaDescription = ['The Brooklyn Navy Yard is a 227-acre publicly owned industrial park characterized by a diversity of small buisnesses. The Navy Yard has more than 2,000 permanent jobs on site, and provides an estimated 3,000 temporary jobs to crews of film and telivision shoots at Steiner Studios. The robust increase in buisness activity between 200 and 2008 is attributed to a dramatic redevlopment effort, harnessing more than $500 million in public and private investment.',
    'Newtown Creek, at over 780 acres the city’s largest SMIA, abuts portions of the Greenpoint, Williamsburg, Long Island City, and Maspeth industrial areas. The waterfront area is characterized by heavy industry and municipal facilities, many of which are water-dependent.',
    'No information about this SMIA yet.',
    'The Red Hook SMIA is approximately 120 acres and is more than 90 percent publicly owned. The SMIA is home to the Red Hook Container Terminal and Brooklyn Piers Port Authority Marine Terminal.',
    'The South Bronx SMIA is more than 850 acres in size, stretching from Port Morris on the Harlem River to Hunts Point on the East river. Wholesale trade is the dominant industry. The SMIA is home to the citys produce distribution center at Hunts Point, the Fulton Fish market, and other food distributors.',
    'Nearly 600 acres, the Sunset Park SMIA extends from Erie Basin to Owls Head, an area characterized by water-dependent facilities, concentrations  of  industrial  activity,  well-buffered  manufacturing  districts,  and  vacant  sites  and  brownfields  of  significant  size.  A  small portion of the SMIA abuts the Gowanus Canal, a waterway that was designated a Superfund Site in 2010.',
    'The Kill Van Kull SMIA stretches from Howland Hook to Snug harbor. It contains a concentration of maritime uses including a marine terminal and dry docks for ship repair. The SMIA is approximately 665 acres and zoned to permit a broad range of commercial and industrial uses. In 2008, there were more than 70 firms emplying more than 3,300 people in the SMIA. The overwhelming number of jobs - more than 70 percent - were in transportation and warehousing.'];
      var smiaLat = [-73.97256593122793,-73.93480042828487,-74.23091192935536,
    -74.00743616089453,-73.8939875925258,-74.01499944630518,-74.13713363755667];
    var smiaLng = [40.70337539892057, 40.73043814252142, 40.5505517824447
    , 40.68650785503232, 40.80730643781723, 40.658442081047724, 40.64057887695694];
    var legendText = {'Percent People of Color': 'From the US census 2016. SMIAs tend to have higher proportions of people of color.',
    'Zoning': 'NYC zoning districts are designated by NYC DOB (?). Though SMIAs are predominately in designated manufacturing zones, they are surrounded by largely residential areas.',
    'Percent of Families Below Poverty Line': 'From the US census 2016. The population within and around SMIAs is frequently below poverty level, especially in #1, Brooklyn Navy Yard and #5, South Bronx',
    'Hurricane Storm Surge Zones': 'Hurricane storm storm surge zones are determined by NYC Emergency Management (?). All SMIAs are in hurricane storm surge zones.',
    'Median Household Income': 'From the US census 2016. The population within and around SMIAs has low household income, especially in #1, Brooklyn Navy Yard and #5, South Bronx',
    'Bulk Storage Sites': 'Bulk storage sites from EPCRA (TRI) and DEC (MOSF, CBS, Superfund). Bulk storage sites are concentrated in SMIAs, especially #2, Newtown Park and #6, Sunset Park'};
    var legendSource = {'Percent People of Color': 'US Census 2010, divided by census tract, downloaded from <a href="http://census.ire.org/data/bulkdata.html">CENSUS.IRE.ORG</a>',
    'Zoning': 'NYC Zoning designations, last updated 2015(?), downloaded from <a href="http://data.beta.nyc//dataset/635e26b3-2acf-4f55-8780-2619660fdf66/resource/e5528464-9a00-40a7-8b85-21e9b25d6c24/download/d52d598c77484806876b8f897d51f805nyczoning.geojson">data.Beta.NYC</a>',
    'Percent of Families Below Poverty Line': 'US Census 2010, divided by census tract, downloaded from <a href="https://factfinder.census.gov/faces/nav/jsf/pages/index.xhtml">US Census Bureau</a>',
    'Hurricane Storm Surge Zones': '(?) 2016 Hurricane evacuation Zones from the <a href="https://geo.nyu.edu/catalog/nyu_2451_34571">NYC-DEM</a>.',
    'Median Household Income': '(?) US Census 2010, divided by census tract, downloaded from <a href="https://factfinder.census.gov/faces/nav/jsf/pages/index.xhtml">US Census Bureau</a>',
    'Bulk Storage Sites': '2016 EPCRA TRI sites from <a href="https://www.epa.gov/toxics-release-inventory-tri-program/tri-basic-data-files-calendar-years-1987-2016">US EPA</a>. DEC active  MOSF, CBS and superfund class 2 sites (7/18/2018) from <a href="https://www.dec.ny.gov/cfmx/extapps/derexternal/index.cfm?pageid=4">NYS DEC</a> and <a href="https://www.dec.ny.gov/cfmx/extapps/derexternal/index.cfm?pageid=3">NYS DEC</a>'};
    // ----------------------------------------
    // |  ** MENU / LAYER SWITCHING  ** |
    // ----------------------------------

    // MH: this now happens with VISIBILITY instead of opacity (to support markers)
    for (var i = 0; i < toggleableLayerIds.length; i++) {
      var id = toggleableLayerIds[i];
      var link = document.createElement('a');
      link.href = '#';
      link.textContent = id;
      if (id === 'Percent People of Color') {
        link.className = 'active';
        legend_info('Percent People of Color')
      } else {
        link.className = '';
      }
      link.id = 'toggler-' + id
      link.onclick = function(e) {
        var clickedLayer = this.textContent;
        e.preventDefault();
        e.stopPropagation();
        for (var j = 0; j < toggleableLayerIds.length; j++) {
          var otherLayerName = toggleableLayerIds[j]
          if (otherLayerName != clickedLayer) {
            document.getElementById('toggler-' + otherLayerName).className = '';
            if (otherLayerName == 'Bulk Storage Sites') {
              map.setLayoutProperty(otherLayerName, 'visibility', 'none');
              map.setLayoutProperty('MOSF', 'visibility', 'none');
              map.setLayoutProperty('CBS', 'visibility', 'none');
              map.setLayoutProperty('SUPERFUND2', 'visibility', 'none');
            } else {
              map.setPaintProperty(otherLayerName, 'fill-opacity', 0);
            }
            document.getElementById(toggleableLegendIds[otherLayerName]).style.display = 'none';
          }
        }
        this.className = 'active';
        if (clickedLayer == 'Bulk Storage Sites') {
          map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
          map.setLayoutProperty('MOSF', 'visibility', 'visible');
          map.setLayoutProperty('CBS', 'visibility', 'visible');
          map.setLayoutProperty('SUPERFUND2', 'visibility', 'visible');
        } else {
          map.setPaintProperty(clickedLayer, 'fill-opacity', 1);
        }
        document.getElementById(toggleableLegendIds[clickedLayer]).style.display = 'block';
        legend_info(clickedLayer)
      };

      var layers = document.getElementById('menu');
      layers.appendChild(link);

    };

    function legend_info(clickedLayer){
      //for (var j = 0; j < toggleableLayerIds.length; j++) {
      //  var jlayer = 'toggler-' + toggleableLayerIds[j];
      //  if(document.getElementById(jlayer).className.includes("active")){
      //    var clickedLayer = toggleableLayerIds[j];
      //  }
      //}
      //document.getElementById('legendinfo').innerHTML = '<p><strong><big>' + clickedLayer + '</big></strong>' + '<small></br></br>' + legendText[clickedLayer] + '</small></p>';
      document.getElementById('legendinfo').innerHTML ='<div style="margin-top:-10px;">'
      +'<p><h4>Source</h4>'
      +'<small>'+legendSource[clickedLayer]+'</br></br></small>'
      +'<h4>Description</h4>'
      +'<small>' + legendText[clickedLayer] + '</small></p>'
      +'</div>';
    }

    function show_legend_info(){
      if (document.getElementById('legendinfo').style.display.includes("block")){
        document.getElementById('legendinfo').style.display='none';
        document.getElementById('legendseam').style.display='none';
      } else {
        document.getElementById('legendinfo').style.display='block';
        document.getElementById('legendseam').style.display='block';
      }
    }

    // reset map view
    function reset_map_view(){
      var flyopts = {
        zoom: 10,
        center: [-73.9978, 40.7209]
      }
      map.flyTo(flyopts)
      showinfobox(event,"none")
    }

    // turn on / off explore and story listeners
    // listeners 101: map.on makes it listen, map.off makes it stop
    // map.on/off("event",("layer"),"Listerner function")

    var global_current_SMIA = -1;

    function manage_listeners(active_listener){

      var blankgeojson = {
        "type": "FeatureCollection",
        "features": []
      };
      // kill manage_listeners
      map.off('click', query_point)
      map.off('mousemove',which_smia);
      map.off('mouseenter',"SMIAfill",smia_hover_on);
      map.off('mouseleave',"SMIAfill",smia_hover_off);
      //remove marker and info
      map.getSource('single-point').setData(blankgeojson);
      overlay.innerHTML = '';
      // selectively activate listeners
      if (active_listener.includes("story")){
        map.on('mousemove',which_smia);
        map.on('mouseenter',"SMIAfill",smia_hover_on);
        map.on('mouseleave',"SMIAfill",smia_hover_off);
        map.on('click',smia_click)
        global_current_SMIA = -1;
        fly_to_smia()
      }
      if (active_listener.includes("explore")){
        map.on('click',query_point);
      }
      if (active_listener.includes("smiazoom")){
        map.on('mouseenter',"SMIAfill",smia_hover_on);
        map.on('mouseleave',"SMIAfill",smia_hover_off);
        map.on('click',smia_click)
      }
    }

    // ---------------------------
    // |  ** EXPLORE  ** |
    // ---------------------------
    function query_point(e){
      // on click query point, display info, and draw marker
      map.getCanvas().style.cursor = 'pointer';
      var queried = map.queryRenderedFeatures(e.point)
      show_explore_info(queried)
      var coords = e.lngLat;
      queried[0].geometry.coordinates = [coords.lng, coords.lat];
      queried[0].geometry.type = "Point";
      console.log(queried[0].geometry)
      map.getSource('single-point').setData(queried[0].geometry);
    }

    function show_explore_info(queried){
      // show info from points queried by marker
      overlay.innerHTML = '';
      var shownData = [];
      for (var j = 0; j < queried.length; j++){
        var data = queried[j].properties
        for (var i = 0; i < Object.keys(dataNames).length; i++) {
          var dataKey = Object.keys(dataNames)[i];
          // if we haven't already found this data and it's not undefined
          var dataDisplay = document.createElement('div');
          if (shownData.indexOf(dataKey) == -1 && typeof(data[dataKey]) != 'undefined') {
            if (dataNames[dataKey].includes('Percent')){
              if (data[dataKey] > 0) {
                dataDisplay.innerHTML = '<b>' + dataNames[dataKey] + '</b>' + Math.round(data[dataKey]) + ' %';
              } else {
                dataDisplay.innerHTML = '<b>' + dataNames[dataKey] + '</b>'  + '<small>not enough data</small>';
              }
              shownData.push(dataKey)
            } else if (dataNames[dataKey].includes('income')){
              if (data[dataKey] > 0) {
                dataDisplay.innerHTML = '<b>' + dataNames[dataKey] + '</b>' + '$ ' + Math.round(data[dataKey]);
              } else {
                dataDisplay.innerHTML = '<b>' + dataNames[dataKey] + '</b>'  + '<small>not enough data</small>';
              }
              shownData.push(dataKey)
            } else {
              dataDisplay.innerHTML = '<b>' + dataNames[dataKey] + '</b>' + data[dataKey];
              shownData.push(dataKey)
            }
            overlay.appendChild(dataDisplay);
          } else {
            if (shownData.indexOf(dataKey) == -1 && dataNames[dataKey].includes('Hurricane') && typeof(data[Object.keys(dataNames)[0]]) != 'undefined'){
              if (data[dataKey] > 0) {
                dataDisplay.innerHTML = '<b>' + dataNames[dataKey] + '</b>' + Math.round(data[dataKey]);
              } else {
                dataDisplay.innerHTML = '<b>' + dataNames[dataKey] + '</b>'  + 'none';
              }
              shownData.push(dataKey)
              overlay.appendChild(dataDisplay);
            }
          }
        }}
        overlay.style.display = 'block';
      }




      // ---------------------------
      // |  ** G E O C O D E R  ** |
      // ---------------------------

      // geocoder code! adds a geocoder and marker
      var geocoder = new MapboxGeocoder({
        accessToken: mapboxgl.accessToken,
        // geocoder zoom level
        zoom: 11,
        // bound geocoder results
        bbox: [-74.274300, 40.487423, -73.693891, 40.858796],
        // apply a client side filter to further limit results to those strictly within NYC
        filter: function (item) {
          // returns true if item contains New South Wales region
          return item.context.map(function (i) {
            // id is in the form {index}.{id} per https://github.com/mapbox/carmen/blob/master/carmen-geojson.md
            // this example attempts to find the `region` named `New York`
            return (i.id.split('.').shift() === 'region' && i.text === 'New York');
          }).reduce(function (acc, cur) {
            return acc || cur;
          });
        }
      });

      //map.addControl(geocoder);
      // put geocoder into div ('geocoder')
      document.getElementById('geocoder').appendChild(geocoder.onAdd(map))
      // Listen for the `geocoder.input` event that is triggered when a user
      // makes a selection and add a symbol that matches the result.
      geocoder.on('result', function(e) {
        // project geocoder result to "point"
        var point = map.project([e.result.center[0], e.result.center[1]]);
        // query rendered features at point
        var queried = map.queryRenderedFeatures(point);
        // show the point box
        show_explore_info(queried)
        // draw the marker
        map.getSource('single-point').setData(e.result.geometry);
      });


      //  map.on('mouseenter', 'Percent People of Color', function (e) {
      //    map.getCanvas().style.cursor = 'pointer';
      //  });

      //  map.on('mouseleave', 'Percent People of Color', function (e) {
      //    map.getCanvas().style.cursor = '';
      //  });

      // ---------------------------
      // |  ** SMIA FILL  ** |
      // ---------------------------

      // MH SMIA FILL CODE
      // -SMIA file uses OBJECTID / SMIA_Name but SMIA buffer file uses SMIA_Name only
      // -Currently all with SMIA_Name + manual ID numbers

      // When the user moves their mouse over the SMIA buffer layer, we'll update the filter in
      // the state-fills-hover layer to only show the matching state, thus making a hover effect.

      var smiaIntro = "As the threats of climate change increase, destructive storms like Superstorm Sandy, Hurricane Katrina, and Hurricane Harvey will expose the vulnerabilities of costal communities overburdened by industrial and chemical facilities. Of interest are NYC’s Significant Maritime and Industrial Areas (SMIAs), clusters of industry and polluting infrastructure along the waterfront. SMIAs are located in classic environmental justice communities- predominantly low-income communities of color - in the south Bronx, Brooklyn, Queens and Staten Island, which are also hurricane storm surge zones. The WJP is a research and advocacy campaign focusing on community resiliency that seeks to reduce potential toxic exposures and public health risks associated with climate change and storm surge in the City’s industrial waterfront.";

      function which_smia(e){
        var whichsmia = map.queryRenderedFeatures(e.point, {
          layers: ['SMIAfill']
        });
        if (whichsmia.length > 0) {
          document.getElementById('smiabox').innerHTML = '<p><strong><big>SMIA # ' + smiaNumbers[whichsmia[0].properties.SMIA_Name] + ' : ' + whichsmia[0].properties.SMIA_Name + '</big></strong>' + '<small></br></br>' + smiaText[whichsmia[0].properties.SMIA_Name] + '</br></br><strong>Source:</strong> <a href="https://www1.nyc.gov/assets/planning/download/pdf/plans-studies/vision-2020-cwp/vision2020/appendix_b.pdf">VISION 2020 comprehensive waterfront plan, Appx. B</a>' + '</small></p>';
        } else {
          document.getElementById('smiabox').innerHTML = '<p><small> ' + smiaIntro + '</small><br/><br/>Click next to start learning about SMIAs, or click on any SMIA for more information. </p> ';
        }
      }

      function smia_hover_on(e) {
        map.setFilter("SMIAhover", ["==", "SMIA_Name", e.features[0].properties.SMIA_Name]);
      }

      // Reset the state-fills-hover layer's filter when the mouse leaves the layer.
      function smia_hover_off(e) {
        map.setFilter("SMIAhover", ["==", "SMIA_Name", ""]);
      }

      // -------------------------
      // | S T O R Y ------------
      // -------------------------

      function smia_click(e){
        // zoom into smia on click
        map.setFilter("SMIAhover", ["==", "SMIA_Name", ""]);
        var whichsmia = map.queryRenderedFeatures(e.point, {
          layers: ['SMIAfill']
        });
        if (whichsmia.length > 0){
          // fly now!
          var smiaNum = smiaNumbers[whichsmia[0].properties.SMIA_Name]-1;
          global_current_SMIA = smiaNum;
          fly_to_smia()
        }
      }

      function fly_to_smia(){
        // fly to smia
        console.log(global_current_SMIA)
        var smiaNum = global_current_SMIA;
        global_current_SMIA = global_current_SMIA+1;
        if (global_current_SMIA>6){global_current_SMIA=-1}

        document.getElementById('zoombutton').style.display = "block";
        //document.getElementById('zoombutton').addEventListener('click',function(){fly_to_smia(smiaNum+1)})

        if (smiaNum<0){document.getElementById('smiabox').innerHTML = '<p><small> ' + smiaIntro + '</small><br/><br/>Click next to start learning about SMIAs, or click on any SMIA for more information. </p> '; return;}
        var flyopts = {
          zoom: 12,
          center: [smiaLat[smiaNum],smiaLng[smiaNum]]
        }

        map.flyTo(flyopts)
        manage_listeners("smiazoom")
        document.getElementById('smiabox').innerHTML = '<p><strong><big>' + smiaTitle[smiaNum] + '</big></strong>' + '<small></br></br>' + smiaDescription[smiaNum] + '</br></br><strong>Source:</strong> <a href="https://www1.nyc.gov/assets/planning/download/pdf/plans-studies/vision-2020-cwp/vision2020/appendix_b.pdf">VISION 2020 comprehensive waterfront plan, Appx. B</a>' + '</small></p>';
        }

      // ------------------------------------------
      // |-------    I N F O    B O X     --------|
      // ------------------------------------------

      // MH: sloppy way of showing and hiding infobox
      //https://www.w3schools.com/howto/howto_js_tabs.asp
      function showinfobox(evt,boxname){
        //variables
        var i, boxcontent, boxlinks, killallboxes;

        // hide everything named box-content
        boxcontent = document.getElementsByClassName("box-content");
        for (i=0; i<boxcontent.length; i++){
          boxcontent[i].style.display = "none";
        }

        // check if clicked box was alread active, if so then kill all boxes
        if (evt.currentTarget.className.includes("active") || boxname.includes("none")) {
          killallboxes = 1;
        }

        // deactivate anything named mode-button
        boxlinks= document.getElementsByClassName("mode-button");
        for (i=0; i<boxlinks.length; i++){
          boxlinks[i].className = boxlinks[i].className.replace(" active","");
        }

        // kill story button
        document.getElementById('zoombutton').style.display = 'none';

        if (killallboxes!=1) {
          // show the current box and make it active!
          document.getElementById(boxname).style.display = "block";
          evt.currentTarget.className += " active";
          if (evt.currentTarget.id.includes("story")) {
            manage_listeners("story")
          } else if (evt.currentTarget.id.includes("explore")) {
            manage_listeners("explore")
          }
        } else {manage_listeners("none")}
      }

      </script>
    </body>
    </html>
