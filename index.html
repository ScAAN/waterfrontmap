<html>
  <meta charset="UTF-8">
  <head>
    <script src='https://api.mapbox.com/mapbox-gl-js/v0.43.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v0.43.0/mapbox-gl.css' rel='stylesheet' />
    <link href='stuff.css' rel='stylesheet' />
  </head>
  <body>
    <style>
      
      .legend {
      background-color: #fff;
      border-radius: 3px;
      bottom: 30px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.10);
      font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
      padding: 10px;
      position: absolute;
      right: 10px;
      z-index: 1;
      }
      
      .legend h4 {
	  margin: 0 0 10px;
      }
      
      .legend div span {
	  border-radius: 50%;
	  display: inline-block;
	  height: 10px;
	  margin-right: 5px;
	  width: 10px;
      }
      
      #menu {
	  background: #fff;
	  position: absolute;
	  z-index: 1;
	  bottom: 30px;
	  left: 30px;
	  border-radius: 3px;
	  width: 120px;
	  border: 1px solid rgba(0,0,0,0.4);
	  font-family: 'Open Sans', sans-serif;
      }
      
      #menu a {
	  font-size: 13px;
	  color: #404040;
	  display: block;
	  margin: 0;
	  padding: 0;
	  padding: 10px;
	  text-decoration: none;
	  border-bottom: 1px solid rgba(0,0,0,0.25);
	  text-align: center;
      }
      
      #menu a:last-child {
	  border: none;
      }
      
      #menu a:hover {
	  background-color: #f8f8f8;
	  color: #404040;
      }
      
      #menu a.active {
	  background-color: #3887be;
	  color: #ffffff;
      }
      
      #menu a.active:hover {
	  background: #3074a4;
      }
      
      .map-overlay-info {
      	  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
      	  background-color: #fff;
      	  box-shadow: 0 1px 2px rgba(0,0,0,0.10);
      	  border-radius: 3px;
      	  position: absolute;
      	  width: 15%;
      	  top: 10px;
      	  right: 10px;
      	  padding: 10px;
      	  display: none;
      }
      
      .text-info-box {
	  overflow: scroll;
      	  background-color: #fff;
      	  box-shadow: 0 1px 2px rgba(0,0,0,0.10);
      	  position: absolute; 
      	  width: 20%;
	  height: 30%;
      	  top: 10px;
      	  left: 10px;
      	  padding: 10px;
      	  display: block;
      }

    </style>    
    <nav id="menu"></nav>
    <title>Waterfront Justice Project</title>
    <div id='map'></div>
    <div id='map-overlay-info' class='map-overlay-info'></div>
    <div id='zoning-legend' class='legend' style='display: none;'>
      <div><span style='outline-color: #000000;outline-style: solid'></span>Significant Maritime and Industrial Areas</div>
      <div><span style='background-color: #ffffff'></span></div>
      <h4>Land use</h4>
      <div><span style='background-color: #7fc97f'></span>Residential</div>
      <div><span style='background-color: #beaed4'></span>NYC Parks</div>
      <div><span style='background-color: #fdc085'></span>Manufacturing</div>
      <div><span style='background-color: #ffff99'></span>Commercial</div>
      <div><span style='background-color: #386cb0'></span>Mixed manufacturing and residential</div>
      <div><span style='background-color: #f0027f'></span>Battery Park City</div>
    </div>
    <div id='race-legend' class='legend' style='display: block;'>
      <div><span style='outline-color: #000000;outline-style: solid'></span>Significant Maritime and Industrial Areas</div>
      <div><span style='background-color: #ffffff'></span></div>
      <h4>Percent People of Color</h4>
      <div><span style='background-color: #e7f0fa'></span>0% &#8211 10%</div>
      <div><span style='background-color: #d6e6f4'></span>11% &#8211 20%</div>
      <div><span style='background-color: #c6dbef'></span>21% &#8211 30%</div>
      <div><span style='background-color: #abd0e6'></span>31% &#8211 40%</div>
      <div><span style='background-color: #8dc1dd'></span>41% &#8211 50%</div>
      <div><span style='background-color: #6aaed6'></span>51% &#8211 60%</div>
      <div><span style='background-color: #4f9bcb'></span>61% &#8211 70%</div>
      <div><span style='background-color: #3787c0'></span>71% &#8211 80%</div>
      <div><span style='background-color: #2070b4'></span>81% &#8211 90%</div>
      <div><span style='background-color: #105ba4'></span>91% &#8211 100%</div>
    </div>
    <div id='poverty-legend' class='legend' style='display: none;'>
      <div><span style='outline-color: #000000;outline-style: solid'></span>Significant Maritime and Industrial Areas</div>
      <div><span style='background-color: #ffffff'></span></div>
      <h4>Percent of Families Below Poverty Line</h4>
      <div><span style='background-color: #fee7dc'></span>0% &#8211 10%</div>
      <div><span style='background-color: #fdd4c2'></span>11% &#8211 20%</div>
      <div><span style='background-color: #fcbba1'></span>21% &#8211 30%</div>
      <div><span style='background-color: #fca082'></span>31% &#8211 40%</div>
      <div><span style='background-color: #fc8565'></span>41% &#8211 50%</div>
      <div><span style='background-color: #fb694a'></span>51% &#8211 60%</div>
      <div><span style='background-color: #f34a36'></span>61% &#8211 70%</div>
      <div><span style='background-color: #e32f27'></span>71% &#8211 80%</div>
      <div><span style='background-color: #ca181d'></span>81% &#8211 90%</div>
      <div><span style='background-color: #b11218'></span>91% &#8211 100%</div>
    </div>
    <div id='surge-legend' class='legend' style='display: none;'>
      <div><span style='outline-color: #000000;outline-style: solid'></span>Significant Maritime and Industrial Areas</div>
      <div><span style='background-color: #ffffff'></span></div>
      <h4>Hurricane Storm Surge Zones</h4>
      <div><span style='background-color: #e31a1c'></span>Category 1, winds of 74 &#8211 95 mph</div>
      <div><span style='background-color: #fd8d3c'></span>Category 2, winds of 96 &#8211 110 mph</div>
      <div><span style='background-color: #fecc5c'></span>Category 3, winds of 111 &#8211 130 mph</div>
      <div><span style='background-color: #ffffb2'></span>Category 4, winds of 131 mph or more</div>
    </div>
    <div id='neighborhood-legend' class='legend' style='display: none;'>
      <div><span style='outline-color: #000000;outline-style: solid'></span>Significant Maritime and Industrial Areas</div>
      <div><span style='background-color: #ffffff'></span></div>
      <h4>Land use</h4>
      <div><span style='background-color: #e31a1c'></span>1</div>
      <div><span style='background-color: #fd8d3c'></span>2</div>
      <div><span style='background-color: #fecc5c'></span>3</div>
      <div><span style='background-color: #ffffb2'></span>4</div>
      <div><span style='background-color: #f0027f'></span>5</div>
    </div>
    <div class='text-info-box'><h2>NYC-EJA Waterfront Justice Project</h2><div id='pd'><p>Current zoning regulations encourage industrial and maritime development in special areas called Special Maritime and Industrial Areas (SMIAs). The SMIA designations are located in largely low-income communities of color in the South Bronx, Brooklyn, Queens, and Staten Island. Development applications in SMIAs are treated differently and to a lower review standard than other waterfront areas, thereby easing the siting and clustering of polluting infrastructure. Climate change impacts and vulnerable populations were not considered in the zoning regulation that crated SMIAs, and so the NYC-EJA advocates that new regulations promote the safe and responsible use of hazardous materials and toxic chemicals to protect those who work and live around the SMIAs; to support climate change adaptation measures; and to protect industrial jobs in the SMIAs.<br /><br />For more details, please refer to Eddie Bautista, Eva Hanhardt, Juan Camilo Osorio & Natasha Dwyer (2015) New York City Environmental Justice Alliance Waterfront Justice Project, Local
Environment: The International Journal of Justice and Sustainability, 20:6, 664-682, DOI:
10.1080/13549839.2014.949644</p></div></div>
    <script>
      mapboxgl.accessToken = 'pk.eyJ1IjoiYmlsbGJyb2QiLCJhIjoiY2o5N21wOWV5MDFlYjJ5bGd4aW9jZWwxNiJ9.LpT502DJ1ruuPRLp3AW_ow';
      var map = new mapboxgl.Map({
	  container: 'map',
	  style: 'mapbox://styles/mapbox/light-v9',
	  center: [-73.9978, 40.7209],
	  zoom: 10,
	  legendControl: {
	      position: 'bottomright'
	  }
      });
      
      var overlay = document.getElementById('map-overlay-info');
      
      map.on('load', function () {

	  map.moveLayer("water", "road-trunk")
	  
	  map.addSource('census-tracts', {
	      type: 'geojson',
	      data: './Data/reduced_census.geojson'
	  })

	  map.addLayer({
	      "id": "Zoning",
	      "type": "fill",
	      "source": {
	  	  type: 'geojson',
	  	  data: './Data/nyzd.geojson'
	      },
	      "paint": {
	  	  "fill-opacity": 0,
	  	  "fill-color": {
	  	      'property': 'human_readable_zone',
	  	      'type': 'categorical',
	  	      "stops": [
	  		  ['Residential', '#7fc97f'],
	  		  ['New York City Parks', '#beaed4'],
	  		  ['Manufacturing', '#fdc086'],
	  		  ['Commercial', '#ffff99'],
	  		  ['Mixed manufacturing and residential', '#386cb0'],
	  		  ['Battery Park City', '#f0027f']
	  	      ]
	  	  }
	      }
	  }, 'water');
	  map.addLayer({
	      "id": "Hurricane Storm Surge Zones",
	      "type": "fill",
	      "source": {
	  	  type: 'geojson',
	  	  data: './Data/storm_surge_min.json'
	      },
	      "paint": {
	  	  "fill-opacity": 0,
	  	  "fill-color": {
		      'property': 'CATEGORY',
	  	      'type': 'categorical',
	  	      "stops": [
	  		  [1, '#e31a1c'],
			  [2, '#fd8d3c'],
	  		  [3, '#fecc5c'],
	  		  [4, '#ffffb2']
	  	      ]
	  	  }
	      }
	  }, 'water');	  
	  map.addLayer({
	      "id": "Neighborhood",
	      "type": "fill",
	      "source": {
	  	  type: 'geojson',
	  	  data: './Data/Neighborhood_Map.geojson'
	      },
	      "paint": {
	  	  "fill-opacity": 0,
	  	  "fill-color": {
		      'property': 'borough',
	  	      'type': 'categorical',
	  	      "stops": [
	  		  [1, '#e31a1c'],
			  [2, '#fd8d3c'],
	  		  [3, '#fecc5c'],
	  		  [4, '#ffffb2'],
			  [5, '#f0027f']
	  	      ]
	  	  }
	      }
	  }, 'water');	  
	  map.addLayer({
	      "id": "Percent People of Color",
	      "type": "fill",
	      "source": 'census-tracts',
	      "paint": {
	  	  "fill-opacity": .75,
	  	  "fill-color": [
	  	      'interpolate',
	  	      ['linear'],
	  	      ['get', 'Perc_POC_P003009'],
	  	      -10, 'rgba(255, 255, 255, 0)',
	  	      0, '#e7f0fa',
	  	      11, '#d6e6f4',
	  	      21, '#c6dbef',
	  	      31, '#abd0e6',
	  	      41, '#8dc1dd',
	  	      51, '#6aaed6',
	  	      61, '#4f9bcb',
	  	      71, '#3787c0',
	  	      81, '#2070b4',
	  	      91, '#105ba4',
	  	      100, '#08468b'
	  	  ]
	      }
	  }, 'water');
	  
	  map.addLayer({
	      "id": "Percent of Families Below Poverty Line",
	      "type": "fill",
	      "source": 'census-tracts',
	      "paint": {
	  	  "fill-opacity": 0,
	  	  "fill-color": [
	  	      'interpolate',
	  	      ['linear'],
	  	      ['get', '% of Families Below Poverty Level'],
	  	      -10, 'rgba(255, 255, 255, 0)',
	  	      0, '#fee7dc',
	  	      10, '#fdd4c2',
	  	      20, '#fcbba1',
	  	      30, '#fca082',
	  	      40, '#fc8565',
	  	      50, '#fb694a',
	  	      60, '#f34a36',
	  	      70, '#e32f27',
	  	      80, '#ca181d',
	  	      90, '#b11218',
	  	      100, '#900a12'
	  	  ]
	      }
	  }, 'water');

	  map.addLayer({
	      "id": "SMIA",
	      "type": "line",
	      "source": {
		  type: 'geojson',
		  data: './Data/smia.json'
	      },
	      "layout": {
		  "line-join": "round",
		  "line-cap": "round"
	      },
	      "paint": {
		  "line-color": "#000000",
		  "line-width": 3
	      }
	  });	  
      });

      var toggleableLayerIds = ['Percent People of Color', 'Zoning', 'Percent of Families Below Poverty Line', 'Hurricane Storm Surge Zones','Neighborhood'];
      var toggleableLegendIds = {'Percent People of Color': 'race-legend',
				 'Zoning': 'zoning-legend',
				 'Percent of Families Below Poverty Line': 'poverty-legend',
				 'Hurricane Storm Surge Zones': 'surge-legend',
				 'Neighborhood': 'neighborhood-legend'};
      var dataNames = {'human_readable_zone': 'Zone: ',
		       'Perc_POC_P003009': 'Percent people of color: ',
		       '% of Families Below Poverty Level': 'Percent of families below poverty line: ',
		       'CATEGORY': 'Hurricane storm surge zone: ',
		       'borough':'NYC Neighborhood Zones'};
      
      for (var i = 0; i < toggleableLayerIds.length; i++) {
      	  var id = toggleableLayerIds[i];
	  
      	  var link = document.createElement('a');
      	  link.href = '#';
      	  link.textContent = id;
	  if (id === 'Percent People of Color') {
	      link.className = 'active';
	  } else {
	      link.className = '';
	  }
	  link.id = 'toggler-' + id
	  
      	  link.onclick = function(e) {
      	      var clickedLayer = this.textContent;
      	      e.preventDefault();
	      e.stopPropagation();
	      for (var j = 0; j < toggleableLayerIds.length; j++) {
		  var otherLayerName = toggleableLayerIds[j]
		  if (otherLayerName != clickedLayer) {
		      document.getElementById('toggler-' + otherLayerName).className = '';
		      map.setPaintProperty(otherLayerName, 'fill-opacity', 0);
		      document.getElementById(toggleableLegendIds[otherLayerName]).style.display = 'none';
		  }
	      }
      	      this.className = 'active';
	      map.setPaintProperty(clickedLayer, 'fill-opacity', .75);
	      document.getElementById(toggleableLegendIds[clickedLayer]).style.display = 'block';	      
      	  };

      	  var layers = document.getElementById('menu');
      	  layers.appendChild(link);

      };
      
      map.on('click', function(e) {
	  // Change the cursor style as a UI indicator.
	  map.getCanvas().style.cursor = 'pointer';
	  
	  var queried = map.queryRenderedFeatures(e.point)
	  overlay.innerHTML = '';
	  var shownData = [];
	  
	  for (var j = 0; j < queried.length; j++){
	      var data = queried[j].properties
	      debugger;
	      
	      for (var i = 0; i < Object.keys(dataNames).length; i++) {
		  
		  var dataKey = Object.keys(dataNames)[i];
		  // if we haven't already found this data
		  if (shownData.indexOf(dataKey) == -1) {
		      var dataDisplay = document.createElement('div');
		      if (dataNames[dataKey].includes('Percent')){
			  dataDisplay.textContent = dataNames[dataKey] + Math.round(data[dataKey]) + '%';
			  shownData.push(dataKey)
		      } else if (typeof(data[dataKey]) != 'undefined') {
			  dataDisplay.textContent = dataNames[dataKey] + data[dataKey];
			  shownData.push(dataKey)
		      }
		      
		      overlay.appendChild(dataDisplay);
		  }
	      }}
	  overlay.style.display = 'block';

      });
      
      map.on('mouseenter', 'Percent People of Color', function (e) {
	  map.getCanvas().style.cursor = 'pointer';
      });
      
      map.on('mouseleave', 'Percent People of Color', function (e) {
	  map.getCanvas().style.cursor = '';
      });

    </script>
  </body>
</html>



